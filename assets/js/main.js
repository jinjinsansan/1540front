const translations = {
  en: {
    meta: {
      title: "1540BO | Digital Options Trading",
    },
    nav: {
      features: "Features",
      platform: "Platform",
      howItWorks: "How it works",
      payments: "Payments",
      support: "Support",
    },
    cta: {
      demo: "Try demo",
      start: "Start trading",
    },
    hero: {
      title: "Ultra-short binary options around the clock",
      subtitle: "Capture every opportunity",
      badges: "Globally licensed • Top crypto pairs • Same-day withdrawals",
      card: {
        title: "Instant order routing",
        execSpeed: "Average execution speed",
        assets: "Tradable assets",
        payout: "Max payout",
      },
    },
    rates: {
      title: "Live market rates",
      subtitle: "Track the most popular crypto pairs in real time.",
      categories: {
        crypto: "Crypto asset",
        fx: "FX pair",
        metal: "Precious metal",
      },
    },
    features: {
      title: "Why traders choose 1540BO",
      subtitle:
        "Seconds-fast binary options windows mean every opportunity is tradable, with an interface built for both pros and newcomers.",
      cards: {
        speed: {
          title: "Millisecond execution",
          text: "Cross-venue routing and deep liquidity pools keep every order filled without slippage spikes.",
        },
        security: {
          title: "Institutional security",
          text: "Tier-1 custodianship, segregation of client funds, and global compliance frameworks.",
        },
        analytics: {
          title: "Trader-first interface",
          text: "Intuitive UI layouts keep every action within easy reach for rapid decisions.",
        },
        support: {
          title: "Pro desk support",
          text: "Veteran risk managers and native-language analysts available 24/7 across five regions.",
        },
      },
    },
    platform: {
      title: "Global platform visibility",
      subtitle:
        "Binary options focus on rapid up/down calls; every user worldwide accesses the same predictive layouts tuned for higher visual clarity.",
      points: {
        one: "Synced layouts across devices",
        two: "One-touch up/down tickets",
        three: "Live sentiment overlays",
        four: "24/7 access to top crypto pairs",
        meta: {
          one: "Switch between desktop and mobile without losing context.",
          two: "Rapid expiry selection with focused call/put actions.",
          three: "Visual heat-maps surface high-probability zones.",
          four: "New tradable pairs roll out regularly to keep markets fresh.",
        },
      },
      visual: {
        title: "Order desk overview",
        buy: "Buy order • BTC/USD • $500 notional @ 1.5x",
        sell: "Sell order • EUR/USD • $800 notional @ 1.7x",
        history: "Closed trades • 98.4% win ratio today",
      },
    },
    steps: {
      title: "Start in three steps",
      items: {
        one: {
          title: "Register",
          text: "Account opens in just 2 minutes",
        },
        two: {
          title: "Practice",
          text: "Trade risk-free on the demo account until your strategy is consistent.",
        },
        three: {
          title: "Go live",
          text: "Fund securely and deploy live trades with transparent payouts.",
        },
      },
    },
    payments: {
      title: "Crypto Deposit Options",
      subtitle: "Multiple cryptocurrencies supported",
    },
    testimonials: {
      title: "Crypto NEWS",
      subtitle: "Check Bloomberg, CoinTelegraph, CoinMarketCap, and other crypto news sources",
      items: {
        one: {
          text: "“Execution speed is unreal—hedging my FX exposure now takes seconds, not minutes.”",
          name: "Ayumi K. • Tokyo",
        },
        two: {
          text: "“Transparent pricing and quick withdrawals give my clients the confidence to scale.”",
          name: "Michael R. • Singapore",
        },
        three: {
          text: "“The multilingual desk understands local regulations, which keeps our compliance spotless.”",
          name: "Supalak P. • Bangkok",
        },
      },
    },
    footer: {
      disclaimer:
        "Trading digital options involves significant risk and may result in the loss of all invested capital. Consider whether you understand how the product works and whether you can afford the risk.",
      links: {
        terms: "Terms",
        privacy: "Privacy",
        security: "Security",
        contact: "Contact",
      },
    },
  },
  ja: {
    meta: {
      title: "1540BO｜デジタルオプション取引",
    },
    nav: {
      features: "特長",
      platform: "プラットフォーム",
      howItWorks: "始め方",
      payments: "入出金",
      support: "サポート",
    },
    cta: {
      demo: "デモ口座を試す",
      start: "本番口座を開く",
    },
    hero: {
      title: "超短時間バイナリーオプション取引を24時間365日提供",
      subtitle: "あらゆる機会に取引可能",
      badges: "国際ライセンス取得 • 人気暗号資産ペア・即日出金対応",
      card: {
        title: "インスタントオーダールーティング",
        execSpeed: "平均約定スピード",
        assets: "取扱銘柄数",
        payout: "最大ペイアウト",
      },
    },
    rates: {
      title: "リアルタイムレート",
      subtitle: "人気暗号資産の最新価格をひと目で把握",
      categories: {
        crypto: "暗号資産",
        fx: "FXペア",
        metal: "貴金属",
      },
    },
    features: {
      title: "1540BOが選ばれる理由",
      subtitle:
        "わずか数十秒単位のバイナリーオプション取引機会があることであらゆる機会を取引可能。プロも初心者も取引しやすいUI設計。",
      cards: {
        speed: {
          title: "ミリ秒執行",
          text: "複数市場へのルーティングと深い流動性でスリッページを抑制。",
        },
        security: {
          title: "機関投資家レベルのセキュリティ",
          text: "資金分別管理と世界基準のコンプライアンスで安心を確保。",
        },
        analytics: {
          title: "取引しやすいUI設計",
          text: "直感で取引出来るユーザーインターフェースを統合",
        },
        support: {
          title: "プロデスクサポート",
          text: "経験豊富なリスクマネージャーが母国語で24時間対応。",
        },
      },
    },
    platform: {
      title: "世界中のユーザーの取引を同じプラットフォーム上で確認可能",
      subtitle:
        "バイナリーオプション取引で最も重要である上昇下降の予測スタイルを世界中のユーザーが同時にアクセス。視覚的に取引勝率を高めやすい設計",
      points: {
        one: "デバイス間で同期されるレイアウト",
        two: "ワンタップで上昇／下降チケット",
        three: "リアルタイムのセンチメント可視化",
        four: "人気暗号資産取引を24時間365日取引可能",
        meta: {
          one: "PCとモバイルを行き来しても文脈を失わないUI",
          two: "満期選択とコール／プット判断を一画面に集約",
          three: "ヒートマップで高勝率ゾーンが即座に見える",
          four: "定期的に取引可能ペアを増加",
        },
      },
      visual: {
        title: "オーダーデスク概要",
        buy: "買い注文 • BTC/USD • 名目500ドル @1.5x",
        sell: "売り注文 • EUR/USD • 名目800ドル @1.7x",
        history: "決済済み取引 • 本日の勝率98.4%",
      },
    },
    steps: {
      title: "3ステップで開始",
      items: {
        one: {
          title: "アカウント登録",
          text: "わずか２分で口座開設完了",
        },
        two: {
          title: "デモで練習",
          text: "戦略が固まるまでリスクゼロで取引を体験。",
        },
        three: {
          title: "本番稼働",
          text: "安全に入金し、透明なペイアウトでライブ取引。",
        },
      },
    },
    payments: {
      title: "暗号資産入金オプション",
      subtitle: "複数の暗号資産を取り扱い",
    },
    testimonials: {
      title: "暗号資産NEWS",
      subtitle: "ブルームバーグ・コインテレグラフ・コインマーケットキャップ・その他の暗号資産NEWSをチェック",
      items: {
        one: {
          title: "ビットコイン、史上最高値を更新",
          text: "機関投資家の関心が高まる中、ビットコインが新たな価格水準に到達。市場アナリストは今後数ヶ月でさらなる上昇を予測している。",
          date: "2025年11月14日",
          link: "続きを読む →",
        },
        two: {
          title: "イーサリアム2.0アップデート完了",
          text: "イーサリアムネットワークの大規模アップグレードが成功裏に完了。取引速度の向上とガス代の削減が実現され、DeFiエコシステムに新たな可能性をもたらす。",
          date: "2025年11月13日",
          link: "続きを読む →",
        },
        three: {
          title: "暗号資産市場、時価総額3兆ドル突破",
          text: "世界的な採用拡大により、暗号資産市場全体の時価総額が過去最高を記録。主要アルトコインも軒並み上昇し、市場の成熟度を示している。",
          date: "2025年11月12日",
          link: "続きを読む →",
        },
      },
    },
    footer: {
      disclaimer:
        "デジタルオプション取引には大きなリスクが伴い、投資資金の全額を失う可能性があります。仕組みの理解度とリスク許容度を十分にご確認ください。",
      links: {
        terms: "利用規約",
        privacy: "プライバシー",
        security: "セキュリティ",
        contact: "お問い合わせ",
      },
    },
  },
  th: {
    meta: {
      title: "1540BO | แพลตฟอร์มดิจิทัลออปชัน",
    },
    nav: {
      features: "จุดเด่น",
      platform: "แพลตฟอร์ม",
      howItWorks: "วิธีเริ่ม",
      payments: "การฝากถอน",
      support: "บริการ",
    },
    cta: {
      demo: "ทดลองบัญชีเดโม",
      start: "เปิดบัญชีจริง",
    },
    hero: {
      title: "ดิจิทัลออปชันระยะสั้นพิเศษเปิดให้เทรด 24/7",
      subtitle: "คว้าโอกาสการเทรดทุกรูปแบบ",
      badges: "ได้รับใบอนุญาตทั่วโลก • คู่คริปโตยอดนิยม • ถอนเงินภายในวันเดียว",
      card: {
        title: "ส่งคำสั่งแบบทันที",
        execSpeed: "ความเร็วเฉลี่ยในการจัดการคำสั่ง",
        assets: "จำนวนสินทรัพย์",
        payout: "อัตราผลตอบแทนสูงสุด",
      },
    },
    rates: {
      title: "อัตราตลาดสด",
      subtitle: "ติดตามคู่คริปโตยอดนิยมแบบเรียลไทม์",
      categories: {
        crypto: "คริปโต",
        fx: "คู่เงิน",
        metal: "โลหะมีค่า",
      },
    },
    features: {
      title: "เหตุผลที่เทรดเดอร์เลือก 1540BO",
      subtitle:
        "หน้าต่างเทรดระดับไม่กี่วินาทีทำให้คว้าโอกาสได้ทุกจังหวะ พร้อม UI ที่เป็นมิตรต่อทั้งมืออาชีพและผู้เริ่มต้น",
      cards: {
        speed: {
          title: "ประมวลผลระดับมิลลิวินาที",
          text: "การส่งคำสั่งข้ามศูนย์ซื้อขายและสภาพคล่องลึก ลดความคลาดเคลื่อนของราคา",
        },
        security: {
          title: "ความปลอดภัยมาตรฐานสถาบัน",
          text: "ดูแลเงินลูกค้าแยกบัญชีและปฏิบัติตามกฎเกณฑ์ระดับโลก",
        },
        analytics: {
          title: "อินเทอร์เฟซที่ออกแบบเพื่อการเทรด",
          text: "จัดวาง UI ให้ใช้งานง่ายและสั่งการได้ทันที",
        },
        support: {
          title: "ทีมซัพพอร์ตมืออาชีพ",
          text: "ผู้จัดการความเสี่ยงที่มีประสบการณ์ให้บริการหลายภาษา 24/7",
        },
      },
    },
    platform: {
      title: "เห็นการเทรดของผู้ใช้ทั่วโลกบนแพลตฟอร์มเดียว",
      subtitle:
        "การเทรด Binary Option แบบทำนายขึ้นลงพร้อมกันทั่วโลก ด้วยเลย์เอาต์ที่ช่วยให้เห็นจังหวะชนะได้ชัดเจน",
      points: {
        one: "เลย์เอาต์ซิงก์กันทุกอุปกรณ์",
        two: "ตั๋วขึ้น/ลงแบบสัมผัสเดียว",
        three: "แผนที่ความรู้สึกตลาดแบบเรียลไทม์",
        four: "เทรดคู่คริปโตยอดนิยมได้ 24/7",
        meta: {
          one: "สลับเดสก์ท็อป-มือถือได้ทันทีโดยไม่เสียบริบท",
          two: "เลือกอายุสัญญาและคอล/พุตในจอเดียว",
          three: "ฮีทแมพช่วยให้เห็นจุดน่าทำกำไรทันที",
          four: "เพิ่มคู่เทรดใหม่อย่างต่อเนื่องให้เลือกทำกำไร",
        },
      },
      visual: {
        title: "ภาพรวมจุดส่งคำสั่ง",
        buy: "คำสั่งซื้อ • BTC/USD • มูลค่า $500 @ 1.5x",
        sell: "คำสั่งขาย • EUR/USD • มูลค่า $800 @ 1.7x",
        history: "ปิดดีลแล้ว • อัตราชนะวันนี้ 98.4%",
      },
    },
    steps: {
      title: "เริ่มง่ายใน 3 ขั้นตอน",
      items: {
        one: {
          title: "ลงทะเบียน",
          text: "เปิดบัญชีได้ภายใน 2 นาที",
        },
        two: {
          title: "ทดลอง",
          text: "ฝึกกลยุทธ์บนบัญชีเดโมโดยไม่ต้องเสี่ยงทุนจริง",
        },
        three: {
          title: "เทรดจริง",
          text: "ฝากเงินปลอดภัยและเริ่มเทรดด้วยการจ่ายผลตอบแทนโปร่งใส",
        },
      },
    },
    payments: {
      title: "ตัวเลือกการฝากด้วยคริปโต",
      subtitle: "รองรับคริปโตหลายสกุล",
    },
    testimonials: {
      title: "ข่าวคริปโต",
      subtitle: "ตรวจสอบ Bloomberg, CoinTelegraph, CoinMarketCap และแหล่งข่าวคริปโตอื่นๆ",
      items: {
        one: {
          text: "“ความเร็วในการส่งคำสั่งสุดยอด ทำให้การป้องกันความเสี่ยง FX ใช้เวลาเพียงไม่กี่วินาที”",
          name: "Ayumi K. • Tokyo",
        },
        two: {
          text: "“ราคาโปร่งใสและถอนเงินไวทำให้ลูกค้าของผมมั่นใจในการเพิ่มขนาดพอร์ต”",
          name: "Michael R. • Singapore",
        },
        three: {
          text: "“ทีมสนับสนุนหลายภาษาเข้าใจกฎระเบียบท้องถิ่น ทำให้เราปฏิบัติตามได้อย่างราบรื่น”",
          name: "Supalak P. • Bangkok",
        },
      },
    },
    footer: {
      disclaimer:
        "การเทรดออปชันดิจิทัลมีความเสี่ยงสูง อาจสูญเสียเงินลงทุนทั้งหมด ควรทำความเข้าใจและประเมินความเสี่ยงก่อนตัดสินใจ",
      links: {
        terms: "ข้อกำหนด",
        privacy: "นโยบายความเป็นส่วนตัว",
        security: "ความปลอดภัย",
        contact: "ติดต่อเรา",
      },
    },
  },
};

const assets = [
  { pair: "BTC/USD", price: 63250.23, change: 1.24, decimals: 2, volatility: 0.0018, categoryKey: "rates.categories.crypto" },
  { pair: "ETH/USD", price: 3420.58, change: -0.74, decimals: 2, volatility: 0.0024, categoryKey: "rates.categories.crypto" },
  { pair: "XRP/USD", price: 0.54, change: 0.32, decimals: 4, volatility: 0.0032, categoryKey: "rates.categories.crypto" },
  { pair: "ADA/USD", price: 0.68, change: -0.15, decimals: 4, volatility: 0.0036, categoryKey: "rates.categories.crypto" },
  { pair: "SOL/USD", price: 148.37, change: 1.82, decimals: 2, volatility: 0.004, categoryKey: "rates.categories.crypto" },
  { pair: "BNB/USD", price: 575.9, change: 0.55, decimals: 2, volatility: 0.0021, categoryKey: "rates.categories.crypto" },
  { pair: "DOGE/USD", price: 0.16, change: -0.48, decimals: 4, volatility: 0.0045, categoryKey: "rates.categories.crypto" },
  { pair: "LTC/USD", price: 86.42, change: 0.64, decimals: 2, volatility: 0.0025, categoryKey: "rates.categories.crypto" },
];

const API_ENDPOINT = window.TICKER_API_ENDPOINT ?? null;

const assetElements = new Map();
let currentLang = "en";

function translate(key, lang = currentLang) {
  const fallback = translations.en;
  const target = translations[lang] || fallback;
  const path = key.split(".");
  let value = path.reduce((acc, segment) => (acc ? acc[segment] : undefined), target);
  if (value !== undefined) {
    return value;
  }
  return path.reduce((acc, segment) => (acc ? acc[segment] : undefined), fallback) ?? key;
}

function applyTranslations(lang) {
  currentLang = lang;
  document.documentElement.lang = lang;
  document.title = translate("meta.title", lang);
  const elements = document.querySelectorAll("[data-i18n]");
  elements.forEach((el) => {
    const key = el.dataset.i18n;
    el.textContent = translate(key, lang);
  });
  renderTicker();
}

function formatPrice(price, decimals) {
  const options = {
    minimumFractionDigits: decimals,
    maximumFractionDigits: decimals,
  };
  return price.toLocaleString(currentLang === "th" ? "th-TH" : currentLang === "ja" ? "ja-JP" : "en-US", options);
}

function formatChange(change) {
  const sign = change >= 0 ? "+" : "";
  return `${sign}${change.toFixed(2)}%`;
}

function renderTicker() {
  const track = document.getElementById("ticker-track");
  if (!track) return;
  track.innerHTML = "";
  assetElements.clear();
  assets.forEach((asset) => {
    const item = document.createElement("div");
    item.className = "ticker-item";

    const pairRow = document.createElement("div");
    pairRow.className = "pair";
    const pairLabel = document.createElement("span");
    pairLabel.textContent = asset.pair;
    const changeLabel = document.createElement("span");
    changeLabel.className = `change ${asset.change >= 0 ? "positive" : "negative"}`;
    changeLabel.textContent = formatChange(asset.change);
    pairRow.append(pairLabel, changeLabel);

    const priceRow = document.createElement("div");
    priceRow.className = "price";
    priceRow.textContent = formatPrice(asset.price, asset.decimals);

    const metaRow = document.createElement("div");
    metaRow.className = "meta";
    metaRow.textContent = translate(asset.categoryKey);

    item.append(pairRow, priceRow, metaRow);
    track.append(item);
    assetElements.set(asset.pair, { priceRow, changeLabel, metaRow });
  });
}

function updateTickerValues(skipDrift = false) {
  assets.forEach((asset) => {
    if (!skipDrift && !API_ENDPOINT) {
      const drift = (Math.random() - 0.5) * asset.volatility;
      const nextPrice = asset.price * (1 + drift);
      asset.price = parseFloat(nextPrice.toFixed(asset.decimals));
      const momentum = asset.change * 0.85 + drift * 100;
      asset.change = parseFloat(momentum.toFixed(2));
    }

    const nodes = assetElements.get(asset.pair);
    if (!nodes) return;
    nodes.priceRow.textContent = formatPrice(asset.price, asset.decimals);
    nodes.changeLabel.textContent = formatChange(asset.change);
    nodes.changeLabel.classList.toggle("positive", asset.change >= 0);
    nodes.changeLabel.classList.toggle("negative", asset.change < 0);
    nodes.metaRow.textContent = translate(asset.categoryKey);
  });
}

async function fetchLiveRates() {
  if (!API_ENDPOINT) return;
  try {
    const response = await fetch(API_ENDPOINT);
    if (!response.ok) throw new Error(`HTTP ${response.status}`);
    const data = await response.json();
    data.forEach((incoming) => {
      const target = assets.find((asset) => asset.pair === incoming.pair);
      if (!target) return;
      target.price = Number(incoming.price) || target.price;
      target.change = Number(incoming.change) || target.change;
    });
    updateTickerValues(true);
  } catch (error) {
    console.error("Failed to fetch live rates", error);
  }
}

function syncLangActiveState(lang) {
  document.querySelectorAll(".lang-switch button, .mobile-lang-switch button").forEach((btn) => {
    btn.classList.toggle("active", btn.dataset.lang === lang);
  });
}

function initLanguageSwitcher() {
  const desktopSwitcher = document.querySelector(".lang-switch");
  desktopSwitcher?.addEventListener("click", (event) => {
    const target = event.target;
    if (!(target instanceof HTMLButtonElement)) return;
    const lang = target.dataset.lang;
    if (!lang || !translations[lang]) return;
    applyTranslations(lang);
    syncLangActiveState(lang);
  });

  const mobileMenuToggle = document.querySelector(".mobile-menu-toggle");
  const mobileMenu = document.querySelector(".mobile-menu");

  document.querySelectorAll(".mobile-lang-switch button").forEach((button) => {
    button.addEventListener("click", () => {
      const lang = button.getAttribute("data-lang");
      if (!lang || !translations[lang]) return;
      applyTranslations(lang);
      syncLangActiveState(lang);
      mobileMenuToggle?.classList.remove("active");
      mobileMenu?.classList.remove("active");
      document.body.classList.remove("no-scroll");
    });
  });
}

document.addEventListener("DOMContentLoaded", () => {
  initLanguageSwitcher();
  applyTranslations(currentLang);
  syncLangActiveState(currentLang);
  setInterval(() => {
    if (API_ENDPOINT) {
      fetchLiveRates();
    } else {
      updateTickerValues();
    }
  }, 5000);
  if (API_ENDPOINT) {
    fetchLiveRates();
  }

  // Mobile Menu Toggle
  const mobileMenuToggle = document.querySelector(".mobile-menu-toggle");
  const mobileMenu = document.querySelector(".mobile-menu");
  const mobileNavLinks = document.querySelectorAll(".mobile-nav a");

  if (mobileMenuToggle && mobileMenu) {
    mobileMenuToggle.addEventListener("click", () => {
      mobileMenuToggle.classList.toggle("active");
      mobileMenu.classList.toggle("active");
      document.body.classList.toggle("no-scroll", mobileMenu.classList.contains("active"));
    });

    mobileNavLinks.forEach((link) => {
      link.addEventListener("click", () => {
        mobileMenuToggle.classList.remove("active");
        mobileMenu.classList.remove("active");
        document.body.classList.remove("no-scroll");
      });
    });

    window.addEventListener("resize", () => {
      if (window.innerWidth > 980 && document.body.classList.contains("no-scroll")) {
        mobileMenuToggle.classList.remove("active");
        mobileMenu.classList.remove("active");
        document.body.classList.remove("no-scroll");
      }
    });
  }
});
